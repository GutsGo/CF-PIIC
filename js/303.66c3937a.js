"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[303],{1303:function(e,a,l){l.r(a),l.d(a,{default:function(){return ke}});var t=l(7738),s=(l(8660),l(7016),l(443));const n={class:"sidebar-container"};function o(e,a,l,o,d,i){const r=(0,s.g2)("font-awesome-icon"),u=t.ct,c=t.lj;return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.bF)(c,{"default-active":l.activeIndex,class:"el-menu-vertical",collapse:d.isCollapse,onSelect:i.handleSelect},{default:(0,s.k6)(()=>[(0,s.bF)(u,{index:"upload",class:"menu-item"},{default:(0,s.k6)(()=>[(0,s.bF)(r,{icon:"cloud-upload",style:{width:"18px"}}),a[1]||(a[1]=(0,s.Lk)("span",{slot:"title"},"上传设置",-1))]),_:1,__:[1]}),(0,s.bF)(u,{index:"security",class:"menu-item"},{default:(0,s.k6)(()=>[(0,s.bF)(r,{icon:"shield",style:{width:"18px"}}),a[2]||(a[2]=(0,s.Lk)("span",{slot:"title"},"安全设置",-1))]),_:1,__:[2]}),(0,s.bF)(u,{index:"page",class:"menu-item"},{default:(0,s.k6)(()=>[(0,s.bF)(r,{icon:"pager",style:{width:"18px"}}),a[3]||(a[3]=(0,s.Lk)("span",{slot:"title"},"网页设置",-1))]),_:1,__:[3]}),(0,s.bF)(u,{index:"others",class:"menu-item"},{default:(0,s.k6)(()=>[(0,s.bF)(r,{icon:"cog",style:{width:"18px"}}),a[4]||(a[4]=(0,s.Lk)("span",{slot:"title"},"其他设置",-1))]),_:1,__:[4]})]),_:1},8,["default-active","collapse","onSelect"]),(0,s.Lk)("div",{class:"toggle-button",onClick:a[0]||(a[0]=(...e)=>i.toggleCollapse&&i.toggleCollapse(...e))},[(0,s.bF)(r,{icon:d.isCollapse?"angle-double-right":"angle-double-left"},null,8,["icon"])])])}var d={name:"SysConfigTabs",props:{activeIndex:{type:String,default:"upload"},isCollapse:{type:Boolean,default:!1}},data(){return{isCollapse:!1}},methods:{toggleCollapse(){this.isCollapse=!this.isCollapse,this.$emit("update:isCollapse",this.isCollapse)},checkMobile(){const e=window.innerWidth<=768;this.isCollapse=e,this.$emit("update:isCollapse",this.isCollapse)},handleSelect(e){this.$emit("update:activeIndex",e)}},mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkMobile)}},i=l(3928);const r=(0,i.A)(d,[["render",o],["__scopeId","data-v-7802b662"]]);var u=r,c=l(8581),m=(l(7541),l(4977)),p=l(3003),h=l(514);const b={class:"container"},g={class:"header-content"},f={class:"header-action"};function k(e,a,l,t,n,o){const d=p.A,i=(0,s.g2)("font-awesome-icon"),r=m.R7,k=c.bZ,w=u;return(0,s.uX)(),(0,s.CE)("div",b,[(0,s.bF)(k,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",g,[(0,s.bF)(d,{activeTab:"systemConfig"}),(0,s.Lk)("div",f,[(0,s.bF)(r,{disabled:o.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,s.k6)(()=>[(0,s.bF)(i,{icon:"sign-out-alt",class:"header-icon",onClick:o.handleLogout},null,8,["onClick"])]),_:1},8,["disabled"])])])]),_:1}),(0,s.bF)(w,{activeIndex:n.activeIndex,"onUpdate:activeIndex":a[0]||(a[0]=e=>n.activeIndex=e),isCollapse:n.isSidebarCollapse,"onUpdate:isCollapse":a[1]||(a[1]=e=>n.isSidebarCollapse=e)},null,8,["activeIndex","isCollapse"]),((0,s.uX)(),(0,s.Wv)((0,s.$y)(o.currentComponent),{class:(0,h.C4)(["main-container",{collapsed:n.isSidebarCollapse}])},null,8,["class"]))])}l(1542);var w=l(4219),F=(l(6871),l(2144)),v=(l(4403),l(5763)),C=(l(9182),l(4078)),_=(l(4177),l(6986),l(6839)),S=(l(1395),l(9922));l(1896),l(3995);const V={class:"upload-settings"},y={class:"upload-channel"},P={class:"first-title"},U={class:"channel-settings"},A={class:"second-title"},I={key:0},x={key:1},L={key:2},E={class:"actions"};function T(e,a,l,t,n,o){const d=(0,s.g2)("font-awesome-icon"),i=m.R7,r=S.ll,u=S.MQ,c=_.qi,p=C.xE,b=C.US,g=v.WK,f=F.S2,k=w.A;return(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",V,[(0,s.Lk)("div",y,[(0,s.Lk)("h3",P,[a[3]||(a[3]=(0,s.eW)("上传渠道 ")),(0,s.bF)(i,{content:"设置每类上传渠道的详细配置 <br> 点击“保存设置”会同时保存对每类配置的修改",placement:"right","raw-content":""},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),(0,s.bF)(u,{modelValue:n.activeChannel,"onUpdate:modelValue":a[0]||(a[0]=e=>n.activeChannel=e)},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.channels,e=>((0,s.uX)(),(0,s.Wv)(r,{key:e.value,label:e.value},{default:(0,s.k6)(()=>[(0,s.eW)((0,h.v_)(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),(0,s.Lk)("div",U,[(0,s.Lk)("h4",A,[(0,s.eW)((0,h.v_)(o.activeChannelLabel)+" 设置 ",1),"telegram"===n.activeChannel?((0,s.uX)(),(0,s.Wv)(i,{key:0,content:"为保证兼容性，v2版本前设置的 Telegram 相关环境变量请保留",placement:"right"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})):(0,s.Q3)("",!0)]),"telegram"===n.activeChannel?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.bF)(b,{model:n.telegramSettings,"label-width":"120px",class:"channel-form"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{label:"负载均衡"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:n.telegramSettings.loadBalance.enabled,"onUpdate:modelValue":a[1]||(a[1]=e=>n.telegramSettings.loadBalance.enabled=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.telegramSettings.channels,(e,a)=>((0,s.uX)(),(0,s.Wv)(b,{key:a,model:e,"label-width":"120px",rules:n.tgRules,ref_for:!0,ref:"tgChannelForm",class:"channel-form"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{label:"渠道名",prop:"name"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"启用渠道",prop:"enabled"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,s.bF)(p,{label:"Bot Token",prop:"botToken"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.botToken,"onUpdate:modelValue":a=>e.botToken=a,disabled:e.fixed,type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"Chat ID",prop:"chatId"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.chatId,"onUpdate:modelValue":a=>e.chatId=a,disabled:e.fixed,type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,null,{default:(0,s.k6)(()=>[(0,s.bF)(f,{type:"danger",onClick:e=>o.deleteChannel(a),size:"small",disabled:e.fixed},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"trash-alt"})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["model","rules"]))),128))])):(0,s.Q3)("",!0),"cfr2"===n.activeChannel?((0,s.uX)(),(0,s.CE)("div",x,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.cfr2Settings.channels,(e,l)=>((0,s.uX)(),(0,s.Wv)(b,{model:e,"label-width":"120px",class:"channel-form"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{label:"渠道名"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"启用渠道"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,s.bF)(p,null,{label:(0,s.k6)(()=>[a[4]||(a[4]=(0,s.eW)(" 公开访问链接 ")),(0,s.bF)(i,{content:"若启用图像审查，请设置该项",placement:"top"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.publicUrl,"onUpdate:modelValue":a=>e.publicUrl=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"]))),256))])):(0,s.Q3)("",!0),"s3"===n.activeChannel?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.bF)(b,{model:n.s3Settings,"label-width":"120px",class:"channel-form"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{label:"负载均衡"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:n.s3Settings.loadBalance.enabled,"onUpdate:modelValue":a[2]||(a[2]=e=>n.s3Settings.loadBalance.enabled=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.s3Settings.channels,(e,l)=>((0,s.uX)(),(0,s.Wv)(b,{model:e,"label-width":"120px",rules:n.s3Rules,ref_for:!0,ref:"s3ChannelForm",class:"channel-form"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{label:"渠道名",prop:"name"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"启用渠道",prop:"enabled"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,s.bF)(p,{prop:"endpoint"},{label:(0,s.k6)(()=>[a[5]||(a[5]=(0,s.eW)(" Endpoint ")),(0,s.bF)(i,{content:"服务提供商 Endpoint，例如 https://s3.us-east-005.backblazeb2.com",placement:"top"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.endpoint,"onUpdate:modelValue":a=>e.endpoint=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"路径风格",prop:"pathStyle"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:e.pathStyle,"onUpdate:modelValue":a=>e.pathStyle=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"存储桶名称",prop:"bucketName"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.bucketName,"onUpdate:modelValue":a=>e.bucketName=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"存储桶区域",prop:"region"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.region,"onUpdate:modelValue":a=>e.region=a,placeholder:"默认填写 auto 即可",disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"访问密钥 ID",prop:"accessKeyId"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.accessKeyId,"onUpdate:modelValue":a=>e.accessKeyId=a,disabled:e.fixed,type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,{label:"机密访问密钥",prop:"secretAccessKey"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{modelValue:e.secretAccessKey,"onUpdate:modelValue":a=>e.secretAccessKey=a,disabled:e.fixed,type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),(0,s.bF)(p,null,{default:(0,s.k6)(()=>[(0,s.bF)(f,{type:"danger",onClick:e=>o.deleteChannel(l),size:"small",disabled:e.fixed},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"trash-alt"})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["model","rules"]))),256))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",E,[(0,s.bF)(f,{type:"primary",onClick:o.addChannel},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"plus"})]),_:1},8,["onClick"]),(0,s.bF)(f,{type:"primary",onClick:o.saveSettings},{default:(0,s.k6)(()=>a[6]||(a[6]=[(0,s.eW)("保存设置")])),_:1,__:[6]},8,["onClick"])])])),[[k,n.loading]])}l(9243),l(2400),l(2557),l(6016),l(6328),l(7369);var W=l(1432),X={data(){return{channels:[{value:"telegram",label:"Telegram"},{value:"cfr2",label:"CloudFlareR2"},{value:"s3",label:"S3"}],activeChannel:"telegram",telegramSettings:{loadBalance:{},channels:[]},tgRules:{name:[{required:!0,message:"请输入渠道名",trigger:"blur"},{validator:(e,a,l)=>{const t=this.telegramSettings.channels.map(e=>e.name);if(t.filter(e=>e===a).length>1)l(new Error("渠道名不能重复"));else if("Telegram_env"===a){const e=this.telegramSettings.channels.find(e=>e.name===a).savePath;"environment variable"!==e?l(new Error("渠道名不能为保留值")):l()}else l()},trigger:"blur"}],botToken:[{required:!0,message:"请输入 Bot Token",trigger:"blur"}],chatId:[{required:!0,message:"请输入 Chat ID",trigger:"blur"}]},cfr2Settings:{channels:[]},s3Settings:{loadBalance:{},channels:[]},s3Rules:{name:[{required:!0,message:"请输入渠道名",trigger:"blur"},{validator:(e,a,l)=>{const t=this.s3Settings.channels.map(e=>e.name);if(t.filter(e=>e===a).length>1)l(new Error("渠道名不能重复"));else if("S3_env"===a){const e=this.s3Settings.channels.find(e=>e.name===a).savePath;"environment variable"!==e?l(new Error("渠道名不能为保留值")):l()}else l()},trigger:"blur"}],endpoint:[{required:!0,message:"请输入 Endpoint",trigger:"blur"}],bucketName:[{required:!0,message:"请输入存储桶名称",trigger:"blur"}],region:[{required:!0,message:"请输入存储桶区域",trigger:"blur"}],accessKeyId:[{required:!0,message:"请输入访问密钥 ID",trigger:"blur"}],secretAccessKey:[{required:!0,message:"请输入机密访问密钥",trigger:"blur"}]},loading:!1}},computed:{activeChannelLabel(){const e=this.channels.find(e=>e.value===this.activeChannel);return e?e.label:""}},methods:{addChannel(){switch(this.activeChannel){case"telegram":this.telegramSettings.channels.push({id:this.telegramSettings.channels.length+1,name:"",type:"telegram",savePath:"database",botToken:"",chatId:"",enabled:!0,fixed:!1});break;case"cfr2":this.$message.error("R2渠道请通过绑定 R2 存储桶或通过 S3 渠道添加");break;case"s3":this.s3Settings.channels.push({id:this.s3Settings.channels.length+1,name:"",type:"s3",savePath:"database",accessKeyId:"",secretAccessKey:"",region:"",bucketName:"",endpoint:"",pathStyle:!1,enabled:!0,fixed:!1});break}},deleteChannel(e){switch(this.activeChannel){case"telegram":this.telegramSettings.channels.forEach((a,l)=>{l>e&&(a.id-=1)}),this.telegramSettings.channels.splice(e,1);break;case"cfr2":this.cfr2Settings.channels.forEach((a,l)=>{l>e&&(a.id-=1)}),this.cfr2Settings.channels.splice(e,1);break;case"s3":this.s3Settings.channels.forEach((a,l)=>{l>e&&(a.id-=1)}),this.s3Settings.channels.splice(e,1);break}},saveSettings(){let e=[];this.$refs.tgChannelForm&&this.$refs.tgChannelForm.forEach(a=>{e.push(new Promise(e=>{a.validate(a=>e(a))}))}),this.$refs.s3ChannelForm&&this.$refs.s3ChannelForm.forEach(a=>{e.push(new Promise(e=>{a.validate(a=>e(a))}))}),Promise.all(e).then(e=>{const a=e.every(e=>e);if(!a)return;const l={telegram:this.telegramSettings,cfr2:this.cfr2Settings,s3:this.s3Settings};(0,W.A)("/api/manage/sysConfig/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(()=>{this.$message.success("设置已保存")})})}},mounted(){this.loading=!0,(0,W.A)("/api/manage/sysConfig/upload").then(e=>e.json()).then(e=>{this.telegramSettings=e.telegram,this.cfr2Settings=e.cfr2,this.s3Settings=e.s3}).finally(()=>{this.loading=!1})}};const K=(0,i.A)(X,[["render",T],["__scopeId","data-v-f7451eda"]]);var q=K,N=l(1478),$=(l(6726),l(4568),l(8006));const D={class:"security-settings"},R={class:"settings-card"},j={class:"settings-card"},B={class:"second-title"},O={class:"settings-card"},Q={class:"actions"};function M(e,a,l,t,n,o){const d=v.WK,i=C.xE,r=C.US,u=(0,s.g2)("font-awesome-icon"),c=m.R7,p=_.qi,h=N.P9,b=N.AV,g=F.S2,f=w.A;return(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",D,[(0,s.Lk)("div",R,[a[11]||(a[11]=(0,s.Lk)("h3",{class:"first-title"},"认证管理",-1)),a[12]||(a[12]=(0,s.Lk)("h4",{class:"second-title"},"用户端认证",-1)),(0,s.bF)(r,{model:n.authSettings.user,rules:n.userPassRules,ref:"userPassForm","label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(i,{label:"上传密码",prop:"authCode"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.authSettings.user.authCode,"onUpdate:modelValue":a[0]||(a[0]=e=>n.authSettings.user.authCode=e),type:"password","show-password":"",onInput:o.handleUserPassInput,autocomplete:"new-password"},null,8,["modelValue","onInput"])]),_:1}),(0,s.bF)($.eB,{name:"fade-slide",mode:"out-in"},{default:(0,s.k6)(()=>[n.showUserPassConfirm?((0,s.uX)(),(0,s.Wv)(i,{label:"确认密码",prop:"confirmNewUserPassword",key:"user-confirm"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.authSettings.user.confirmNewUserPassword,"onUpdate:modelValue":a[1]||(a[1]=e=>n.authSettings.user.confirmNewUserPassword=e),type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})):(0,s.Q3)("",!0)]),_:1})]),_:1},8,["model","rules"]),a[13]||(a[13]=(0,s.Lk)("h4",{class:"second-title"},"管理端认证",-1)),(0,s.bF)(r,{model:n.authSettings.admin,rules:n.adminPassRules,ref:"adminPassForm","label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(i,{label:"用户名",prop:"adminUsername"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.authSettings.admin.adminUsername,"onUpdate:modelValue":a[2]||(a[2]=e=>n.authSettings.admin.adminUsername=e),autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),(0,s.bF)(i,{label:"密码",prop:"adminPassword"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.authSettings.admin.adminPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>n.authSettings.admin.adminPassword=e),type:"password","show-password":"",onInput:o.handleAdminPassInput,autocomplete:"new-password"},null,8,["modelValue","onInput"])]),_:1}),(0,s.bF)($.eB,{name:"fade-slide",mode:"out-in"},{default:(0,s.k6)(()=>[n.showAdminPassConfirm?((0,s.uX)(),(0,s.Wv)(i,{label:"确认密码",prop:"confirmNewAdminPassword",key:"admin-confirm"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.authSettings.admin.confirmNewAdminPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>n.authSettings.admin.confirmNewAdminPassword=e),type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})):(0,s.Q3)("",!0)]),_:1})]),_:1},8,["model","rules"])]),(0,s.Lk)("div",j,[a[15]||(a[15]=(0,s.Lk)("h3",{class:"first-title"},"上传管理",-1)),(0,s.Lk)("h4",B,[a[14]||(a[14]=(0,s.eW)("图像审查 ")),(0,s.bF)(c,{content:"支持 nsfwjs 和 moderatecontent.com 渠道",placement:"top"},{default:(0,s.k6)(()=>[(0,s.bF)(u,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),(0,s.bF)(r,{model:n.uploadSettings.moderate,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(i,{label:"开启审查"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{modelValue:n.uploadSettings.moderate.enabled,"onUpdate:modelValue":a[5]||(a[5]=e=>n.uploadSettings.moderate.enabled=e)},null,8,["modelValue"])]),_:1}),(0,s.bF)(i,{label:"审查渠道"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{modelValue:n.uploadSettings.moderate.channel,"onUpdate:modelValue":a[6]||(a[6]=e=>n.uploadSettings.moderate.channel=e),placeholder:"请选择审查渠道"},{default:(0,s.k6)(()=>[(0,s.bF)(h,{label:"默认（官方提供）",value:"default"}),(0,s.bF)(h,{label:"moderatecontent.com",value:"moderatecontent.com"}),(0,s.bF)(h,{label:"nsfwjs",value:"nsfwjs"})]),_:1},8,["modelValue"])]),_:1}),"moderatecontent.com"===n.uploadSettings.moderate.channel?((0,s.uX)(),(0,s.Wv)(i,{key:0,label:"API Key"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.uploadSettings.moderate.moderateContentApiKey,"onUpdate:modelValue":a[7]||(a[7]=e=>n.uploadSettings.moderate.moderateContentApiKey=e)},null,8,["modelValue"])]),_:1})):(0,s.Q3)("",!0),"nsfwjs"===n.uploadSettings.moderate.channel?((0,s.uX)(),(0,s.Wv)(i,{key:1,label:"API 路径"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.uploadSettings.moderate.nsfwApiPath,"onUpdate:modelValue":a[8]||(a[8]=e=>n.uploadSettings.moderate.nsfwApiPath=e),placeholder:"https://nsfwjs.your.domain"},null,8,["modelValue"])]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["model"])]),(0,s.Lk)("div",O,[a[18]||(a[18]=(0,s.Lk)("h3",{class:"first-title"},"访问管理",-1)),a[19]||(a[19]=(0,s.Lk)("h4",{class:"second-title"},"域名过滤",-1)),(0,s.bF)(r,{model:n.accessSettings,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(i,null,{label:(0,s.k6)(()=>[a[16]||(a[16]=(0,s.eW)(" 放行域名 ")),(0,s.bF)(c,{content:"1.针对访问域名设置权限 <br/> 2.留空默认全部放行，多个域名请用英文逗号分隔",placement:"top","raw-content":""},{default:(0,s.k6)(()=>[(0,s.bF)(u,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),default:(0,s.k6)(()=>[(0,s.bF)(d,{modelValue:n.accessSettings.allowedDomains,"onUpdate:modelValue":a[9]||(a[9]=e=>n.accessSettings.allowedDomains=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a[20]||(a[20]=(0,s.Lk)("h4",{class:"second-title"},"白名单模式",-1)),(0,s.bF)(r,{model:n.accessSettings,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(i,null,{label:(0,s.k6)(()=>[a[17]||(a[17]=(0,s.eW)(" 是否开启 ")),(0,s.bF)(c,{content:"1.针对文件设置权限 <br> 2.开启后，仅被加入白名单的文件可被访问",placement:"top","raw-content":""},{default:(0,s.k6)(()=>[(0,s.bF)(u,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),default:(0,s.k6)(()=>[(0,s.bF)(p,{modelValue:n.accessSettings.whiteListMode,"onUpdate:modelValue":a[10]||(a[10]=e=>n.accessSettings.whiteListMode=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),(0,s.Lk)("div",Q,[(0,s.bF)(g,{type:"primary",onClick:o.saveSettings},{default:(0,s.k6)(()=>a[21]||(a[21]=[(0,s.eW)("保存设置")])),_:1,__:[21]},8,["onClick"])])])),[[f,n.loading]])}var z={data(){return{authSettings:{user:{},admin:{}},uploadSettings:{moderate:{}},accessSettings:{},loading:!1,oriUserPassword:"",oriAdminPassword:"",showUserPassConfirm:!1,showAdminPassConfirm:!1,userPassRules:{authCode:[{validator:(e,a,l)=>{const t=["%","&","?","#","/"],s=t.some(e=>a&&a.includes(e));s?l(new Error("密码不能包含部分URL保留字符: % & ? # /")):l()},trigger:"blur"}],confirmNewUserPassword:[{message:"请再次输入上传密码",trigger:"blur"},{validator:(e,a,l)=>{a&&a!==this.authSettings.user.authCode?l(new Error("两次输入密码不一致")):l()},trigger:"blur"}]},adminPassRules:{confirmNewAdminPassword:[{message:"请再次输入管理密码",trigger:"blur"},{validator:(e,a,l)=>{a&&a!==this.authSettings.admin.adminPassword?l(new Error("两次输入密码不一致")):l()},trigger:"blur"}]}}},computed:{},methods:{handleUserPassInput(){this.authSettings.user.authCode!==this.oriUserPassword?this.showUserPassConfirm=!0:this.showUserPassConfirm=!1},handleAdminPassInput(){this.authSettings.admin.adminPassword!==this.oriAdminPassword?this.showAdminPassConfirm=!0:this.showAdminPassConfirm=!1},saveSettings(){let e=[];e.push(new Promise(e=>{this.$refs.userPassForm.validate(a=>{e(a)})})),e.push(new Promise(e=>{this.$refs.adminPassForm.validate(a=>{e(a)})})),Promise.all(e).then(e=>{const a=e.every(e=>e);if(!a)return;const l={auth:this.authSettings,upload:this.uploadSettings,access:this.accessSettings};delete l.auth.user.confirmNewUserPassword,delete l.auth.admin.confirmNewAdminPassword,(0,W.A)("/api/manage/sysConfig/security",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(()=>{this.$message.success("设置已保存"),this.oriUserPassword=this.authSettings.user.authCode,this.oriAdminPassword=this.authSettings.admin.adminPassword,this.showUserPassConfirm=!1,this.showAdminPassConfirm=!1})})}},mounted(){this.loading=!0,(0,W.A)("/api/manage/sysConfig/security").then(e=>e.json()).then(e=>{this.authSettings=e.auth,this.uploadSettings=e.upload,this.accessSettings=e.access,this.oriUserPassword=this.authSettings.user.authCode,this.oriAdminPassword=this.authSettings.admin.adminPassword,this.authSettings.user.confirmNewUserPassword="",this.authSettings.admin.confirmNewAdminPassword=""}).finally(()=>{this.loading=!1})}};const J=(0,i.A)(z,[["render",M],["__scopeId","data-v-c124e62c"]]);var Z=J;const H={class:"page-settings"},Y={class:"settings-card"},G={class:"actions"};function ee(e,a,l,t,n,o){const d=(0,s.g2)("font-awesome-icon"),i=m.R7,r=v.WK,u=C.xE,c=C.US,p=F.S2,b=w.A;return(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",H,[(0,s.Lk)("div",Y,[a[0]||(a[0]=(0,s.Lk)("h3",{class:"first-title"},"页面设置",-1)),(0,s.bF)(c,{model:n.settings,"label-width":"150px"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.settings.config,(e,a)=>((0,s.uX)(),(0,s.Wv)(u,{key:a},{label:(0,s.k6)(()=>[(0,s.eW)((0,h.v_)(e.label)+" ",1),e.tooltip?((0,s.uX)(),(0,s.Wv)(i,{key:0,content:e.tooltip,placement:"top","raw-content":""},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:2},1032,["content"])):(0,s.Q3)("",!0)]),default:(0,s.k6)(()=>[(0,s.bF)(r,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,disabled:e.fixed,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder"])]),_:2},1024))),128))]),_:1},8,["model"])]),(0,s.Lk)("div",G,[(0,s.bF)(p,{type:"primary",onClick:o.saveSettings},{default:(0,s.k6)(()=>a[1]||(a[1]=[(0,s.eW)("保存设置")])),_:1,__:[1]},8,["onClick"])])])),[[b,n.loading]])}var ae={data(){return{settings:{config:[]},loading:!1}},computed:{},methods:{saveSettings(){(0,W.A)("/api/manage/sysConfig/page",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)}).then(()=>this.$message.success("设置已保存"))}},mounted(){this.loading=!0,(0,W.A)("/api/manage/sysConfig/page").then(e=>e.json()).then(e=>{this.settings=e}).finally(()=>{this.loading=!1})}};const le=(0,i.A)(ae,[["render",ee],["__scopeId","data-v-69f541b5"]]);var te=le;const se={class:"others-settings"},ne={class:"settings-card"},oe={class:"second-title"},de={class:"settings-card"},ie={class:"second-title"},re={class:"settings-card"},ue={class:"second-title"},ce={class:"actions"};function me(e,a,l,t,n,o){const d=(0,s.g2)("font-awesome-icon"),i=m.R7,r=_.qi,u=C.xE,c=C.US,p=v.WK,h=F.S2,b=w.A;return(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",se,[a[11]||(a[11]=(0,s.Lk)("div",{class:"settings-card"},[(0,s.Lk)("h3",{class:"first-title"},"其他设置")],-1)),(0,s.Lk)("div",ne,[(0,s.Lk)("h4",oe,[a[6]||(a[6]=(0,s.eW)("远端遥测 ")),(0,s.bF)(i,{content:"便于问题查找和定位，建议开启",placement:"right"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),(0,s.bF)(c,{model:n.settings.telemetry,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(u,{label:"启用"},{default:(0,s.k6)(()=>[(0,s.bF)(r,{modelValue:n.settings.telemetry.enabled,"onUpdate:modelValue":a[0]||(a[0]=e=>n.settings.telemetry.enabled=e),disabled:n.settings.telemetry.fixed},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),(0,s.Lk)("div",de,[(0,s.Lk)("h4",ie,[a[7]||(a[7]=(0,s.eW)("随机图像API ")),(0,s.bF)(i,{content:"API具体用法请查阅文档",placement:"right"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),(0,s.bF)(c,{model:n.settings.randomImageAPI,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(u,{label:"启用"},{default:(0,s.k6)(()=>[(0,s.bF)(r,{modelValue:n.settings.randomImageAPI.enabled,"onUpdate:modelValue":a[1]||(a[1]=e=>n.settings.randomImageAPI.enabled=e),disabled:n.settings.randomImageAPI.fixed},null,8,["modelValue","disabled"])]),_:1}),(0,s.bF)(u,{prop:"randomImageAPI.allowedDir"},{label:(0,s.k6)(()=>[a[8]||(a[8]=(0,s.Lk)("span",null,"目录",-1)),(0,s.bF)(i,{content:"1. 开放随机图权限的目录，默认为根目录，多个目录用逗号分隔 <br/> 2. 目录均采用绝对路径，例如/img/cover，表示该目录及其所有子目录的文件可被随机图API访问",placement:"right","raw-content":""},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),default:(0,s.k6)(()=>[(0,s.bF)(p,{modelValue:n.settings.randomImageAPI.allowedDir,"onUpdate:modelValue":a[2]||(a[2]=e=>n.settings.randomImageAPI.allowedDir=e),disabled:n.settings.randomImageAPI.fixed},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),(0,s.Lk)("div",re,[(0,s.Lk)("h4",ue,[a[9]||(a[9]=(0,s.eW)("CloudFlare API Token ")),(0,s.bF)(i,{content:"设置后可以使后端拉黑、删除等操作不受CDN缓存限制 <br/> 建议设置,设置方式请查阅文档",placement:"right","raw-content":""},{default:(0,s.k6)(()=>[(0,s.bF)(d,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})]),_:1})]),(0,s.bF)(c,{model:n.settings.cloudflareApiToken,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(u,{label:"区域ID"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{modelValue:n.settings.cloudflareApiToken.CF_ZONE_ID,"onUpdate:modelValue":a[3]||(a[3]=e=>n.settings.cloudflareApiToken.CF_ZONE_ID=e),disabled:n.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])]),_:1}),(0,s.bF)(u,{label:"账户邮箱"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{modelValue:n.settings.cloudflareApiToken.CF_EMAIL,"onUpdate:modelValue":a[4]||(a[4]=e=>n.settings.cloudflareApiToken.CF_EMAIL=e),disabled:n.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])]),_:1}),(0,s.bF)(u,{label:"API Key"},{default:(0,s.k6)(()=>[(0,s.bF)(p,{modelValue:n.settings.cloudflareApiToken.CF_API_KEY,"onUpdate:modelValue":a[5]||(a[5]=e=>n.settings.cloudflareApiToken.CF_API_KEY=e),disabled:n.settings.cloudflareApiToken.fixed,type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),(0,s.Lk)("div",ce,[(0,s.bF)(h,{type:"primary",onClick:o.saveSettings},{default:(0,s.k6)(()=>a[10]||(a[10]=[(0,s.eW)("保存设置")])),_:1,__:[10]},8,["onClick"])])])),[[b,n.loading]])}var pe={data(){return{settings:{telemetry:{},randomImageAPI:{},cloudflareApiToken:{}},loading:!1}},computed:{},methods:{saveSettings(){(0,W.A)("/api/manage/sysConfig/others",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)}).then(()=>this.$message.success("设置已保存"))}},mounted(){this.loading=!0,(0,W.A)("/api/manage/sysConfig/others").then(e=>e.json()).then(e=>{this.settings=e}).finally(()=>{this.loading=!1})}};const he=(0,i.A)(pe,[["render",me],["__scopeId","data-v-90ebbac8"]]);var be=he,ge={name:"SystemConfig",data(){return{activeIndex:"upload",isSidebarCollapse:!1}},watch:{"$route.hash":{immediate:!0,handler(e){this.activeIndex=e.replace("#",""),window.scrollTo(0,0)}},activeIndex(e){const a=`#${e}`;this.$router.push({hash:a})}},components:{DashboardTabs:p.A,SysConfigTabs:u,SysCogUpload:q,SysCogSecurity:Z,SysCogPage:te,SysCogOthers:be},computed:{disableTooltip(){return window.innerWidth<768},currentComponent(){const e=this.$route.hash.replace("#","");switch(e){case"security":return Z;case"page":return te;case"others":return be;default:return q}}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},setDefaultHash(){const e="#upload";window.location.hash=e,this.activeIndex=e.replace("#","")}},mounted(){window.location.hash||this.setDefaultHash()}};const fe=(0,i.A)(ge,[["render",k],["__scopeId","data-v-6192b3da"]]);var ke=fe},1395:function(e,a,l){l(8660)},1896:function(e,a,l){l(8660)},3995:function(e,a,l){l(8660)},4177:function(e,a,l){l(8660)},6986:function(e,a,l){l(8660)}}]);
//# sourceMappingURL=303.66c3937a.js.map