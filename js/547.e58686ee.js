"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[547],{797:function(e,a,t){t.d(a,{A:function(){return s}});t(4114),t(4979);var n=t(5774),i=t(1219),o=t(6181);async function s(e,a={}){const t=n.A.getters.credentials||btoa("unset:unset");a.headers={...a.headers,Authorization:`Basic ${t}`},a.credentials="include";const s=await fetch(e,a);return 401===s.status&&(i.nk.error("认证状态错误，请重新登录"),o.A.push("/adminLogin")),s}},8044:function(e,a,t){t.d(a,{A:function(){return c}});var n=t(4275),i=(t(5331),t(1008),t(7410),t(6768));const o={class:"dashboard-tabs"};function s(e,a,t,s,l,d){const r=(0,i.g2)("font-awesome-icon"),c=n.v$,u=n.q;return(0,i.uX)(),(0,i.CE)("div",o,[(0,i.bF)(u,{"model-value":t.activeTab,onTabClick:d.handleTabClick,class:"m3-tabs"},{default:(0,i.k6)((()=>[(0,i.bF)(c,{label:"Gallery",name:"dashboard"},{label:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"images"}),a[0]||(a[0]=(0,i.eW)(" Gallery "))])),_:1}),(0,i.bF)(c,{label:"User Management",name:"customerConfig"},{label:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"user-cog"}),a[1]||(a[1]=(0,i.eW)(" User Management "))])),_:1}),(0,i.bF)(c,{label:"System Settings",name:"systemConfig"},{label:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"cogs"}),a[2]||(a[2]=(0,i.eW)(" System Settings "))])),_:1})])),_:1},8,["model-value","onTabClick"])])}t(4114);var l={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},methods:{handleTabClick(e){this.$router.push(`/${e.props.name}`)}}},d=t(1241);const r=(0,d.A)(l,[["render",s],["__scopeId","data-v-2908e39a"]]);var c=r},6547:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});var n=t(9114),i=(t(5331),t(694),t(47)),o=(t(9648),t(7815)),s=(t(2907),t(5558)),l=(t(456),t(6023)),d=(t(8736),t(213),t(5970),t(7009)),r=(t(8450),t(8785),t(1450)),c=t(8044),u=t(6768);const p={class:"customer-config"},h={class:"top-app-bar"},m={class:"actions"},b={class:"main-content"},g={class:"expanded-content"},f=["src"],k={key:2,class:"file-placeholder"},C={class:"pagination-container"};function v(e,a,t,v,w,y){const F=c.A,T=(0,u.g2)("font-awesome-icon"),L=r.R7,S=l.o8,D=d.Zq,A=l.Up,_=s.qi,z=o.aQ,E=i.S2,P=n.L;return(0,u.uX)(),(0,u.CE)("div",p,[(0,u.Lk)("header",h,[(0,u.bF)(F,{activeTab:"customerConfig"}),(0,u.Lk)("div",m,[(0,u.bF)(L,{disabled:y.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.Lk)("button",{class:"m3-icon-button",onClick:a[0]||(a[0]=(...e)=>y.handleLogout&&y.handleLogout(...e))},[(0,u.bF)(T,{icon:"sign-out-alt"})])])),_:1},8,["disabled"])])]),(0,u.Lk)("main",b,[(0,u.bo)(((0,u.uX)(),(0,u.Wv)(A,{data:y.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"m3-table"},{default:(0,u.k6)((()=>[(0,u.bF)(S,{type:"expand"},{default:(0,u.k6)((e=>[(0,u.Lk)("div",g,[a[1]||(a[1]=(0,u.Lk)("h3",null,"Uploaded Files",-1)),(0,u.bF)(A,{data:e.row.data,class:"m3-table nested-table"},{default:(0,u.k6)((()=>[(0,u.bF)(S,{prop:"metadata.FileName",label:"File Name"}),(0,u.bF)(S,{prop:"name",label:"Preview"},{default:(0,u.k6)((({row:e})=>[e.metadata?.FileType?.includes("image")?((0,u.uX)(),(0,u.Wv)(D,{key:0,src:"/file/"+e.name+"?from=admin",fit:"cover",lazy:"",class:"preview-image"},null,8,["src"])):e.metadata?.FileType?.includes("video")?((0,u.uX)(),(0,u.CE)("video",{key:1,src:"/file/"+e.name+"?from=admin",controls:"",class:"preview-video"},null,8,f)):((0,u.uX)(),(0,u.CE)("div",k,[(0,u.bF)(T,{icon:"file",size:"2x"})]))])),_:1}),(0,u.bF)(S,{prop:"metadata.TimeStamp",label:"Upload Time",sortable:"",formatter:y.formatTimeStamp},null,8,["formatter"])])),_:2},1032,["data"])])])),_:1}),(0,u.bF)(S,{prop:"ip",label:"IP Address"}),(0,u.bF)(S,{prop:"address",label:"Address"}),(0,u.bF)(S,{prop:"count",label:"Upload Count",sortable:""}),(0,u.bF)(S,{label:"Allowed to Upload"},{default:(0,u.k6)((({row:e})=>[(0,u.bF)(_,{modelValue:e.enable,"onUpdate:modelValue":a=>e.enable=a,onChange:a=>y.handleSwitchEnable(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data"])),[[P,w.loading]]),(0,u.Lk)("div",C,[(0,u.bF)(z,{background:"",layout:"prev, pager, next",total:w.dealedData.length,"current-page":w.currentPage,"page-size":w.pageSize,onCurrentChange:y.handlePageChange},null,8,["total","current-page","page-size","onCurrentChange"]),w.currentPage===Math.ceil(w.dealedData.length/w.pageSize)?((0,u.uX)(),(0,u.Wv)(E,{key:0,type:"primary",onClick:y.loadMoreData,loading:w.loading,class:"load-more"},{default:(0,u.k6)((()=>a[2]||(a[2]=[(0,u.eW)("Load More")]))),_:1},8,["onClick","loading"])):(0,u.Q3)("",!0)])])])}t(4114);var w=t(797),y={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:c.A},computed:{disableTooltip(){return window.innerWidth<768},paginatedData(){const e=(this.currentPage-1)*this.pageSize,a=e+this.pageSize;return this.dealedData.slice(e,a)}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,a){return new Date(e.metadata.TimeStamp)-new Date(a.metadata.TimeStamp)},async handleSwitchEnable(e){const a=e.ip,t=e.enable;t?(this.blockipList=this.blockipList.filter((e=>e!==a)),await(0,w.A)("/api/manage/cusConfig/whiteip",{method:"POST",body:a})):(this.blockipList.push(a),await(0,w.A)("/api/manage/cusConfig/blockip",{method:"POST",body:a}))},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},loadMoreData(){this.loading=!0;const e=this.dealedData.length,a=20;(0,w.A)(`/api/manage/cusConfig/list?start=${e}&count=${a}`,{method:"GET"}).then((e=>e.json())).then((e=>{this.dealedData=this.dealedData.concat(e.map((e=>{const a=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:a}})))})).catch((()=>{this.$message.error("加载更多数据时出错，请检查网络连接")})).finally((()=>{this.loading=!1}))},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},mounted(){this.loading=!0,(0,w.A)("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)return this.showLogoutButton=!0,(0,w.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});if("Not using basic auth."==e)return(0,w.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});throw new Error("Unauthorized")})).then((e=>e.json())).then((async e=>{const a=await(0,w.A)("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await a.text()).split(","),this.dealedData=e.map((e=>{const a=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:a}}))})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")})).finally((()=>{this.loading=!1}))}},F=t(1241);const T=(0,F.A)(y,[["render",v],["__scopeId","data-v-e8f4e810"]]);var L=T},8736:function(e,a,t){t(5331)},8450:function(e,a,t){t(5331)},694:function(e,a,t){t(5331)},7819:function(e,a,t){t(5331)},2907:function(e,a,t){t(5331),t(6808)},9104:function(e,a,t){t(5331)},5970:function(e,a,t){t(5331)},6808:function(e,a,t){t(5331),t(8785),t(7819),t(5970),t(9104)},456:function(e,a,t){t(5331)},7410:function(e,a,t){t(5331)},1008:function(e,a,t){t(5331)},8785:function(e,a,t){t(5331)},213:function(e,a,t){t(5331),t(9104)}}]);
//# sourceMappingURL=547.e58686ee.js.map