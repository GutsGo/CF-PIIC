"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[480],{797:function(e,a,l){l.d(a,{A:function(){return d}});l(4114),l(4979);var t=l(5774),s=l(1219),n=l(6181);async function d(e,a={}){const l=t.A.getters.credentials||btoa("unset:unset");a.headers={...a.headers,Authorization:`Basic ${l}`},a.credentials="include";const d=await fetch(e,a);return 401===d.status&&(s.nk.error("认证状态错误，请重新登录"),n.A.push("/adminLogin")),d}},8044:function(e,a,l){l.d(a,{A:function(){return u}});var t=l(4275),s=(l(5331),l(1008),l(7410),l(6768));const n={class:"dashboard-tabs"};function d(e,a,l,d,o,i){const r=(0,s.g2)("font-awesome-icon"),u=t.v$,c=t.q;return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.bF)(c,{"model-value":l.activeTab,onTabClick:i.handleTabClick,class:"m3-tabs"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{label:"Gallery",name:"dashboard"},{label:(0,s.k6)((()=>[(0,s.bF)(r,{icon:"images"}),a[0]||(a[0]=(0,s.eW)(" Gallery "))])),_:1}),(0,s.bF)(u,{label:"User Management",name:"customerConfig"},{label:(0,s.k6)((()=>[(0,s.bF)(r,{icon:"user-cog"}),a[1]||(a[1]=(0,s.eW)(" User Management "))])),_:1}),(0,s.bF)(u,{label:"System Settings",name:"systemConfig"},{label:(0,s.k6)((()=>[(0,s.bF)(r,{icon:"cogs"}),a[2]||(a[2]=(0,s.eW)(" System Settings "))])),_:1})])),_:1},8,["model-value","onTabClick"])])}l(4114);var o={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},methods:{handleTabClick(e){this.$router.push(`/${e.props.name}`)}}},i=l(1241);const r=(0,i.A)(o,[["render",d],["__scopeId","data-v-2908e39a"]]);var u=r},3480:function(e,a,l){l.r(a),l.d(a,{default:function(){return ie}});var t=l(6768),s=l(4232);const n={class:"rail-items"};function d(e,a,l,d,o,i){const r=(0,t.g2)("font-awesome-icon");return(0,t.uX)(),(0,t.CE)("nav",{class:(0,s.C4)(["navigation-rail",{collapsed:l.isCollapse}])},[(0,t.Lk)("div",n,[(0,t.Lk)("button",{class:(0,s.C4)(["rail-item",{active:"upload"===l.activeIndex}]),onClick:a[0]||(a[0]=e=>i.handleSelect("upload"))},[(0,t.bF)(r,{icon:"cloud-upload"}),a[5]||(a[5]=(0,t.Lk)("span",{class:"label"},"Upload",-1))],2),(0,t.Lk)("button",{class:(0,s.C4)(["rail-item",{active:"security"===l.activeIndex}]),onClick:a[1]||(a[1]=e=>i.handleSelect("security"))},[(0,t.bF)(r,{icon:"shield"}),a[6]||(a[6]=(0,t.Lk)("span",{class:"label"},"Security",-1))],2),(0,t.Lk)("button",{class:(0,s.C4)(["rail-item",{active:"page"===l.activeIndex}]),onClick:a[2]||(a[2]=e=>i.handleSelect("page"))},[(0,t.bF)(r,{icon:"pager"}),a[7]||(a[7]=(0,t.Lk)("span",{class:"label"},"Page",-1))],2),(0,t.Lk)("button",{class:(0,s.C4)(["rail-item",{active:"others"===l.activeIndex}]),onClick:a[3]||(a[3]=e=>i.handleSelect("others"))},[(0,t.bF)(r,{icon:"cog"}),a[8]||(a[8]=(0,t.Lk)("span",{class:"label"},"Others",-1))],2)]),(0,t.Lk)("div",{class:"toggle-button",onClick:a[4]||(a[4]=(...e)=>i.toggleCollapse&&i.toggleCollapse(...e))},[(0,t.bF)(r,{icon:l.isCollapse?"angle-double-right":"angle-double-left"},null,8,["icon"])])],2)}var o={name:"SysConfigTabs",props:{activeIndex:String,isCollapse:Boolean},methods:{toggleCollapse(){this.$emit("update:isCollapse",!this.isCollapse)},handleSelect(e){this.$emit("update:activeIndex",e)}}},i=l(1241);const r=(0,i.A)(o,[["render",d],["__scopeId","data-v-ef4eb398"]]);var u=r,c=l(1450),m=(l(5331),l(213),l(8044));const h={class:"system-config"},b={class:"top-app-bar"},g={class:"actions"},p={class:"main-layout"};function f(e,a,l,n,d,o){const i=m.A,r=(0,t.g2)("font-awesome-icon"),f=c.R7,k=u;return(0,t.uX)(),(0,t.CE)("div",h,[(0,t.Lk)("header",b,[(0,t.bF)(i,{activeTab:"systemConfig"}),(0,t.Lk)("div",g,[(0,t.bF)(f,{disabled:e.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,t.k6)((()=>[(0,t.Lk)("button",{class:"m3-icon-button",onClick:a[0]||(a[0]=(...e)=>o.handleLogout&&o.handleLogout(...e))},[(0,t.bF)(r,{icon:"sign-out-alt"})])])),_:1},8,["disabled"])])]),(0,t.Lk)("div",p,[(0,t.bF)(k,{activeIndex:d.activeIndex,"onUpdate:activeIndex":a[1]||(a[1]=e=>d.activeIndex=e),isCollapse:d.isSidebarCollapse,"onUpdate:isCollapse":a[2]||(a[2]=e=>d.isSidebarCollapse=e)},null,8,["activeIndex","isCollapse"]),(0,t.Lk)("main",{class:(0,s.C4)(["main-content",{collapsed:d.isSidebarCollapse}])},[((0,t.uX)(),(0,t.Wv)((0,t.$y)(o.currentComponent)))],2)])])}l(4114);var k=l(9114),C=(l(694),l(4275)),S=(l(1008),l(7410),l(47)),v=(l(9648),l(2105)),w=(l(9092),l(2006)),F=(l(8642),l(3003),l(5558));l(456);const V={class:"upload-settings"},y={class:"channel-settings"},_={key:0},P={key:1},U={key:2},A={class:"actions"};function I(e,a,l,s,n,d){const o=F.qi,i=w.xE,r=w.US,u=v.WK,c=(0,t.g2)("font-awesome-icon"),m=S.S2,h=C.v$,b=C.q,g=k.L;return(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",V,[(0,t.bF)(b,{modelValue:n.activeChannel,"onUpdate:modelValue":a[2]||(a[2]=e=>n.activeChannel=e),class:"m3-tabs"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.channels,(e=>((0,t.uX)(),(0,t.Wv)(h,{key:e.value,label:e.label,name:e.value},{default:(0,t.k6)((()=>[(0,t.Lk)("div",y,["telegram"===n.activeChannel?((0,t.uX)(),(0,t.CE)("div",_,[(0,t.bF)(r,{model:n.telegramSettings,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Load Balancing"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.telegramSettings.loadBalance.enabled,"onUpdate:modelValue":a[0]||(a[0]=e=>n.telegramSettings.loadBalance.enabled=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.telegramSettings.channels,((e,a)=>((0,t.uX)(),(0,t.Wv)(r,{key:a,model:e,"label-width":"120px",rules:n.tgRules,ref_for:!0,ref:"tgChannelForm",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Channel Name",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Enable Channel",prop:"enabled"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,t.bF)(i,{label:"Bot Token",prop:"botToken"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.botToken,"onUpdate:modelValue":a=>e.botToken=a,disabled:e.fixed,type:"password","show-password":""},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Chat ID",prop:"chatId"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.chatId,"onUpdate:modelValue":a=>e.chatId=a,disabled:e.fixed,type:"password","show-password":""},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,null,{default:(0,t.k6)((()=>[(0,t.bF)(m,{type:"danger",onClick:e=>d.deleteChannel(a),disabled:e.fixed},{default:(0,t.k6)((()=>[(0,t.bF)(c,{icon:"trash-alt"})])),_:2},1032,["onClick","disabled"])])),_:2},1024)])),_:2},1032,["model","rules"])))),128))])):(0,t.Q3)("",!0),"cfr2"===n.activeChannel?((0,t.uX)(),(0,t.CE)("div",P,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.cfr2Settings.channels,((e,a)=>((0,t.uX)(),(0,t.Wv)(r,{model:e,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Channel Name"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Enable Channel"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,t.bF)(i,{label:"Public URL"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.publicUrl,"onUpdate:modelValue":a=>e.publicUrl=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model"])))),256))])):(0,t.Q3)("",!0),"s3"===n.activeChannel?((0,t.uX)(),(0,t.CE)("div",U,[(0,t.bF)(r,{model:n.s3Settings,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Load Balancing"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.s3Settings.loadBalance.enabled,"onUpdate:modelValue":a[1]||(a[1]=e=>n.s3Settings.loadBalance.enabled=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.s3Settings.channels,((e,a)=>((0,t.uX)(),(0,t.Wv)(r,{model:e,"label-width":"120px",rules:n.s3Rules,ref_for:!0,ref:"s3ChannelForm",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Channel Name",prop:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Enable Channel",prop:"enabled"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,t.bF)(i,{label:"Endpoint",prop:"endpoint"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.endpoint,"onUpdate:modelValue":a=>e.endpoint=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Path Style",prop:"pathStyle"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:e.pathStyle,"onUpdate:modelValue":a=>e.pathStyle=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Bucket Name",prop:"bucketName"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.bucketName,"onUpdate:modelValue":a=>e.bucketName=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Region",prop:"region"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.region,"onUpdate:modelValue":a=>e.region=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Access Key ID",prop:"accessKeyId"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.accessKeyId,"onUpdate:modelValue":a=>e.accessKeyId=a,disabled:e.fixed,type:"password","show-password":""},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,{label:"Secret Access Key",prop:"secretAccessKey"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.secretAccessKey,"onUpdate:modelValue":a=>e.secretAccessKey=a,disabled:e.fixed,type:"password","show-password":""},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,t.bF)(i,null,{default:(0,t.k6)((()=>[(0,t.bF)(m,{type:"danger",onClick:e=>d.deleteChannel(a),disabled:e.fixed},{default:(0,t.k6)((()=>[(0,t.bF)(c,{icon:"trash-alt"})])),_:2},1032,["onClick","disabled"])])),_:2},1024)])),_:2},1032,["model","rules"])))),256))])):(0,t.Q3)("",!0)])])),_:2},1032,["label","name"])))),128))])),_:1},8,["modelValue"]),(0,t.Lk)("div",A,[(0,t.bF)(m,{type:"primary",onClick:d.addChannel},{default:(0,t.k6)((()=>[(0,t.bF)(c,{icon:"plus"}),a[3]||(a[3]=(0,t.eW)(" Add Channel "))])),_:1},8,["onClick"]),(0,t.bF)(m,{type:"primary",onClick:d.saveSettings},{default:(0,t.k6)((()=>a[4]||(a[4]=[(0,t.eW)("Save Settings")]))),_:1},8,["onClick"])])])),[[g,n.loading]])}var L=l(797),x={data(){return{channels:[{value:"telegram",label:"Telegram"},{value:"cfr2",label:"CloudFlareR2"},{value:"s3",label:"S3"}],activeChannel:"telegram",telegramSettings:{loadBalance:{},channels:[]},tgRules:{name:[{required:!0,message:"请输入渠道名",trigger:"blur"},{validator:(e,a,l)=>{const t=this.telegramSettings.channels.map((e=>e.name));if(t.filter((e=>e===a)).length>1)l(new Error("渠道名不能重复"));else if("Telegram_env"===a){const e=this.telegramSettings.channels.find((e=>e.name===a)).savePath;"environment variable"!==e?l(new Error("渠道名不能为保留值")):l()}else l()},trigger:"blur"}],botToken:[{required:!0,message:"请输入 Bot Token",trigger:"blur"}],chatId:[{required:!0,message:"请输入 Chat ID",trigger:"blur"}]},cfr2Settings:{channels:[]},s3Settings:{loadBalance:{},channels:[]},s3Rules:{name:[{required:!0,message:"请输入渠道名",trigger:"blur"},{validator:(e,a,l)=>{const t=this.s3Settings.channels.map((e=>e.name));if(t.filter((e=>e===a)).length>1)l(new Error("渠道名不能重复"));else if("S3_env"===a){const e=this.s3Settings.channels.find((e=>e.name===a)).savePath;"environment variable"!==e?l(new Error("渠道名不能为保留值")):l()}else l()},trigger:"blur"}],endpoint:[{required:!0,message:"请输入 Endpoint",trigger:"blur"}],bucketName:[{required:!0,message:"请输入存储桶名称",trigger:"blur"}],region:[{required:!0,message:"请输入存储桶区域",trigger:"blur"}],accessKeyId:[{required:!0,message:"请输入访问密钥 ID",trigger:"blur"}],secretAccessKey:[{required:!0,message:"请输入机密访问密钥",trigger:"blur"}]},loading:!1}},computed:{activeChannelLabel(){const e=this.channels.find((e=>e.value===this.activeChannel));return e?e.label:""}},methods:{addChannel(){switch(this.activeChannel){case"telegram":this.telegramSettings.channels.push({id:this.telegramSettings.channels.length+1,name:"",type:"telegram",savePath:"database",botToken:"",chatId:"",enabled:!0,fixed:!1});break;case"cfr2":this.$message.error("R2渠道请通过绑定 R2 存储桶或通过 S3 渠道添加");break;case"s3":this.s3Settings.channels.push({id:this.s3Settings.channels.length+1,name:"",type:"s3",savePath:"database",accessKeyId:"",secretAccessKey:"",region:"",bucketName:"",endpoint:"",pathStyle:!1,enabled:!0,fixed:!1});break}},deleteChannel(e){switch(this.activeChannel){case"telegram":this.telegramSettings.channels.forEach(((a,l)=>{l>e&&(a.id-=1)})),this.telegramSettings.channels.splice(e,1);break;case"cfr2":this.cfr2Settings.channels.forEach(((a,l)=>{l>e&&(a.id-=1)})),this.cfr2Settings.channels.splice(e,1);break;case"s3":this.s3Settings.channels.forEach(((a,l)=>{l>e&&(a.id-=1)})),this.s3Settings.channels.splice(e,1);break}},saveSettings(){let e=[];this.$refs.tgChannelForm&&this.$refs.tgChannelForm.forEach((a=>{e.push(new Promise((e=>{a.validate((a=>e(a)))})))})),this.$refs.s3ChannelForm&&this.$refs.s3ChannelForm.forEach((a=>{e.push(new Promise((e=>{a.validate((a=>e(a)))})))})),Promise.all(e).then((e=>{const a=e.every((e=>e));if(!a)return;const l={telegram:this.telegramSettings,cfr2:this.cfr2Settings,s3:this.s3Settings};(0,L.A)("/api/manage/sysConfig/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((()=>{this.$message.success("设置已保存")}))}))}},mounted(){this.loading=!0,(0,L.A)("/api/manage/sysConfig/upload").then((e=>e.json())).then((e=>{this.telegramSettings=e.telegram,this.cfr2Settings=e.cfr2,this.s3Settings=e.s3})).finally((()=>{this.loading=!1}))}};const E=(0,i.A)(x,[["render",I],["__scopeId","data-v-7992749f"]]);var T=E,K=l(2248),N=(l(6808),l(7819),l(683));l(5385);const W={class:"security-settings"},X={class:"card-content"},$={class:"card-content"},D={class:"card-content"},R={class:"actions"};function q(e,a,l,s,n,d){const o=v.WK,i=w.xE,r=w.US,u=N.Ik,c=F.qi,m=K.P9,h=K.AV,b=S.S2,g=k.L;return(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",W,[(0,t.bF)(u,{class:"m3-card"},{header:(0,t.k6)((()=>a[11]||(a[11]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"Authentication Management")],-1)]))),default:(0,t.k6)((()=>[(0,t.Lk)("div",X,[a[12]||(a[12]=(0,t.Lk)("h4",{class:"second-title"},"User Authentication",-1)),(0,t.bF)(r,{model:n.authSettings.user,rules:n.userPassRules,ref:"userPassForm","label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Upload Password",prop:"authCode"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.authSettings.user.authCode,"onUpdate:modelValue":a[0]||(a[0]=e=>n.authSettings.user.authCode=e),type:"password","show-password":"",onInput:d.handleUserPassInput},null,8,["modelValue","onInput"])])),_:1}),n.showUserPassConfirm?((0,t.uX)(),(0,t.Wv)(i,{key:0,label:"Confirm Password",prop:"confirmNewUserPassword"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.authSettings.user.confirmNewUserPassword,"onUpdate:modelValue":a[1]||(a[1]=e=>n.authSettings.user.confirmNewUserPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})):(0,t.Q3)("",!0)])),_:1},8,["model","rules"]),a[13]||(a[13]=(0,t.Lk)("h4",{class:"second-title"},"Admin Authentication",-1)),(0,t.bF)(r,{model:n.authSettings.admin,rules:n.adminPassRules,ref:"adminPassForm","label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Username",prop:"adminUsername"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.authSettings.admin.adminUsername,"onUpdate:modelValue":a[2]||(a[2]=e=>n.authSettings.admin.adminUsername=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"Password",prop:"adminPassword"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.authSettings.admin.adminPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>n.authSettings.admin.adminPassword=e),type:"password","show-password":"",onInput:d.handleAdminPassInput},null,8,["modelValue","onInput"])])),_:1}),n.showAdminPassConfirm?((0,t.uX)(),(0,t.Wv)(i,{key:0,label:"Confirm Password",prop:"confirmNewAdminPassword"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.authSettings.admin.confirmNewAdminPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>n.authSettings.admin.confirmNewAdminPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})):(0,t.Q3)("",!0)])),_:1},8,["model","rules"])])])),_:1}),(0,t.bF)(u,{class:"m3-card"},{header:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"Upload Management")],-1)]))),default:(0,t.k6)((()=>[(0,t.Lk)("div",$,[a[15]||(a[15]=(0,t.Lk)("h4",{class:"second-title"},"Image Moderation",-1)),(0,t.bF)(r,{model:n.uploadSettings.moderate,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Enable Moderation"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{modelValue:n.uploadSettings.moderate.enabled,"onUpdate:modelValue":a[5]||(a[5]=e=>n.uploadSettings.moderate.enabled=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"Channel"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:n.uploadSettings.moderate.channel,"onUpdate:modelValue":a[6]||(a[6]=e=>n.uploadSettings.moderate.channel=e)},{default:(0,t.k6)((()=>[(0,t.bF)(m,{label:"Default",value:"default"}),(0,t.bF)(m,{label:"moderatecontent.com",value:"moderatecontent.com"}),(0,t.bF)(m,{label:"nsfwjs",value:"nsfwjs"})])),_:1},8,["modelValue"])])),_:1}),"moderatecontent.com"===n.uploadSettings.moderate.channel?((0,t.uX)(),(0,t.Wv)(i,{key:0,label:"API Key"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.uploadSettings.moderate.moderateContentApiKey,"onUpdate:modelValue":a[7]||(a[7]=e=>n.uploadSettings.moderate.moderateContentApiKey=e)},null,8,["modelValue"])])),_:1})):(0,t.Q3)("",!0),"nsfwjs"===n.uploadSettings.moderate.channel?((0,t.uX)(),(0,t.Wv)(i,{key:1,label:"API Path"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.uploadSettings.moderate.nsfwApiPath,"onUpdate:modelValue":a[8]||(a[8]=e=>n.uploadSettings.moderate.nsfwApiPath=e)},null,8,["modelValue"])])),_:1})):(0,t.Q3)("",!0)])),_:1},8,["model"])])])),_:1}),(0,t.bF)(u,{class:"m3-card"},{header:(0,t.k6)((()=>a[16]||(a[16]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"Access Management")],-1)]))),default:(0,t.k6)((()=>[(0,t.Lk)("div",D,[a[17]||(a[17]=(0,t.Lk)("h4",{class:"second-title"},"Domain Filtering",-1)),(0,t.bF)(r,{model:n.accessSettings,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Allowed Domains"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.accessSettings.allowedDomains,"onUpdate:modelValue":a[9]||(a[9]=e=>n.accessSettings.allowedDomains=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),a[18]||(a[18]=(0,t.Lk)("h4",{class:"second-title"},"Whitelist Mode",-1)),(0,t.bF)(r,{model:n.accessSettings,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Enable Whitelist"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{modelValue:n.accessSettings.whiteListMode,"onUpdate:modelValue":a[10]||(a[10]=e=>n.accessSettings.whiteListMode=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1}),(0,t.Lk)("div",R,[(0,t.bF)(b,{type:"primary",onClick:d.saveSettings},{default:(0,t.k6)((()=>a[19]||(a[19]=[(0,t.eW)("Save Settings")]))),_:1},8,["onClick"])])])),[[g,n.loading]])}var B={data(){return{authSettings:{user:{},admin:{}},uploadSettings:{moderate:{}},accessSettings:{},loading:!1,oriUserPassword:"",oriAdminPassword:"",showUserPassConfirm:!1,showAdminPassConfirm:!1,userPassRules:{authCode:[{validator:(e,a,l)=>{const t=["%","&","?","#","/"],s=t.some((e=>a&&a.includes(e)));s?l(new Error("密码不能包含部分URL保留字符: % & ? # /")):l()},trigger:"blur"}],confirmNewUserPassword:[{message:"请再次输入上传密码",trigger:"blur"},{validator:(e,a,l)=>{a&&a!==this.authSettings.user.authCode?l(new Error("两次输入密码不一致")):l()},trigger:"blur"}]},adminPassRules:{confirmNewAdminPassword:[{message:"请再次输入管理密码",trigger:"blur"},{validator:(e,a,l)=>{a&&a!==this.authSettings.admin.adminPassword?l(new Error("两次输入密码不一致")):l()},trigger:"blur"}]}}},computed:{},methods:{handleUserPassInput(){this.authSettings.user.authCode!==this.oriUserPassword?this.showUserPassConfirm=!0:this.showUserPassConfirm=!1},handleAdminPassInput(){this.authSettings.admin.adminPassword!==this.oriAdminPassword?this.showAdminPassConfirm=!0:this.showAdminPassConfirm=!1},saveSettings(){let e=[];e.push(new Promise((e=>{this.$refs.userPassForm.validate((a=>{e(a)}))}))),e.push(new Promise((e=>{this.$refs.adminPassForm.validate((a=>{e(a)}))}))),Promise.all(e).then((e=>{const a=e.every((e=>e));if(!a)return;const l={auth:this.authSettings,upload:this.uploadSettings,access:this.accessSettings};delete l.auth.user.confirmNewUserPassword,delete l.auth.admin.confirmNewAdminPassword,(0,L.A)("/api/manage/sysConfig/security",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((()=>{this.$message.success("设置已保存"),this.oriUserPassword=this.authSettings.user.authCode,this.oriAdminPassword=this.authSettings.admin.adminPassword,this.showUserPassConfirm=!1,this.showAdminPassConfirm=!1}))}))}},mounted(){this.loading=!0,(0,L.A)("/api/manage/sysConfig/security").then((e=>e.json())).then((e=>{this.authSettings=e.auth,this.uploadSettings=e.upload,this.accessSettings=e.access,this.oriUserPassword=this.authSettings.user.authCode,this.oriAdminPassword=this.authSettings.admin.adminPassword,this.authSettings.user.confirmNewUserPassword="",this.authSettings.admin.confirmNewAdminPassword=""})).finally((()=>{this.loading=!1}))}};const O=(0,i.A)(B,[["render",q],["__scopeId","data-v-0ad6c43b"]]);var M=O;const j={class:"page-settings"},Q={class:"card-content"},J={class:"actions"};function Z(e,a,l,n,d,o){const i=(0,t.g2)("font-awesome-icon"),r=c.R7,u=v.WK,m=w.xE,h=w.US,b=N.Ik,g=S.S2,p=k.L;return(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",j,[(0,t.bF)(b,{class:"m3-card"},{header:(0,t.k6)((()=>a[0]||(a[0]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"Page Settings")],-1)]))),default:(0,t.k6)((()=>[(0,t.Lk)("div",Q,[(0,t.bF)(h,{model:d.settings,"label-width":"150px",class:"m3-form"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(d.settings.config,((e,a)=>((0,t.uX)(),(0,t.Wv)(m,{key:a},{label:(0,t.k6)((()=>[(0,t.eW)((0,s.v_)(e.label)+" ",1),e.tooltip?((0,t.uX)(),(0,t.Wv)(r,{key:0,content:e.tooltip,placement:"top","raw-content":""},{default:(0,t.k6)((()=>[(0,t.bF)(i,{icon:"question-circle"})])),_:2},1032,["content"])):(0,t.Q3)("",!0)])),default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,disabled:e.fixed,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder"])])),_:2},1024)))),128))])),_:1},8,["model"])])])),_:1}),(0,t.Lk)("div",J,[(0,t.bF)(g,{type:"primary",onClick:o.saveSettings},{default:(0,t.k6)((()=>a[1]||(a[1]=[(0,t.eW)("Save Settings")]))),_:1},8,["onClick"])])])),[[p,d.loading]])}var G={data(){return{settings:{config:[]},loading:!1}},computed:{},methods:{saveSettings(){(0,L.A)("/api/manage/sysConfig/page",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)}).then((()=>this.$message.success("设置已保存")))}},mounted(){this.loading=!0,(0,L.A)("/api/manage/sysConfig/page").then((e=>e.json())).then((e=>{this.settings=e})).finally((()=>{this.loading=!1}))}};const H=(0,i.A)(G,[["render",Z],["__scopeId","data-v-39d595e2"]]);var Y=H;const z={class:"others-settings"},ee={class:"card-content"},ae={class:"actions"};function le(e,a,l,s,n,d){const o=F.qi,i=w.xE,r=w.US,u=v.WK,c=N.Ik,m=S.S2,h=k.L;return(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",z,[(0,t.bF)(c,{class:"m3-card"},{header:(0,t.k6)((()=>a[6]||(a[6]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"Other Settings")],-1)]))),default:(0,t.k6)((()=>[(0,t.Lk)("div",ee,[a[7]||(a[7]=(0,t.Lk)("h4",{class:"second-title"},"Telemetry",-1)),(0,t.bF)(r,{model:n.settings.telemetry,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Enable"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.settings.telemetry.enabled,"onUpdate:modelValue":a[0]||(a[0]=e=>n.settings.telemetry.enabled=e),disabled:n.settings.telemetry.fixed},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"]),a[8]||(a[8]=(0,t.Lk)("h4",{class:"second-title"},"Random Image API",-1)),(0,t.bF)(r,{model:n.settings.randomImageAPI,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Enable"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:n.settings.randomImageAPI.enabled,"onUpdate:modelValue":a[1]||(a[1]=e=>n.settings.randomImageAPI.enabled=e),disabled:n.settings.randomImageAPI.fixed},null,8,["modelValue","disabled"])])),_:1}),(0,t.bF)(i,{label:"Allowed Directory"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:n.settings.randomImageAPI.allowedDir,"onUpdate:modelValue":a[2]||(a[2]=e=>n.settings.randomImageAPI.allowedDir=e),disabled:n.settings.randomImageAPI.fixed},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"]),a[9]||(a[9]=(0,t.Lk)("h4",{class:"second-title"},"Cloudflare API Token",-1)),(0,t.bF)(r,{model:n.settings.cloudflareApiToken,"label-width":"120px",class:"m3-form"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"Zone ID"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:n.settings.cloudflareApiToken.CF_ZONE_ID,"onUpdate:modelValue":a[3]||(a[3]=e=>n.settings.cloudflareApiToken.CF_ZONE_ID=e),disabled:n.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])])),_:1}),(0,t.bF)(i,{label:"Email"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:n.settings.cloudflareApiToken.CF_EMAIL,"onUpdate:modelValue":a[4]||(a[4]=e=>n.settings.cloudflareApiToken.CF_EMAIL=e),disabled:n.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])])),_:1}),(0,t.bF)(i,{label:"API Key"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:n.settings.cloudflareApiToken.CF_API_KEY,"onUpdate:modelValue":a[5]||(a[5]=e=>n.settings.cloudflareApiToken.CF_API_KEY=e),disabled:n.settings.cloudflareApiToken.fixed,type:"password","show-password":""},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"])])])),_:1}),(0,t.Lk)("div",ae,[(0,t.bF)(m,{type:"primary",onClick:d.saveSettings},{default:(0,t.k6)((()=>a[10]||(a[10]=[(0,t.eW)("Save Settings")]))),_:1},8,["onClick"])])])),[[h,n.loading]])}var te={data(){return{settings:{telemetry:{},randomImageAPI:{},cloudflareApiToken:{}},loading:!1}},computed:{},methods:{saveSettings(){(0,L.A)("/api/manage/sysConfig/others",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)}).then((()=>this.$message.success("设置已保存")))}},mounted(){this.loading=!0,(0,L.A)("/api/manage/sysConfig/others").then((e=>e.json())).then((e=>{this.settings=e})).finally((()=>{this.loading=!1}))}};const se=(0,i.A)(te,[["render",le],["__scopeId","data-v-5e5fe9de"]]);var ne=se,de={name:"SystemConfig",data(){return{activeIndex:"upload",isSidebarCollapse:!1}},watch:{"$route.hash":{immediate:!0,handler(e){this.activeIndex=e.replace("#",""),window.scrollTo(0,0)}},activeIndex(e){const a=`#${e}`;this.$router.push({hash:a})}},components:{DashboardTabs:m.A,SysConfigTabs:u,SysCogUpload:T,SysCogSecurity:M,SysCogPage:Y,SysCogOthers:ne},computed:{currentComponent(){const e=this.$route.hash.replace("#","");switch(e){case"security":return M;case"page":return Y;case"others":return ne;default:return T}}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},setDefaultHash(){const e="#upload";window.location.hash=e,this.activeIndex=e.replace("#","")}},mounted(){window.location.hash||this.setDefaultHash()}};const oe=(0,i.A)(de,[["render",f],["__scopeId","data-v-408f3376"]]);var ie=oe},5385:function(e,a,l){l(5331)},3003:function(e,a,l){l(5331)},8642:function(e,a,l){l(5331)},694:function(e,a,l){l(5331)},7819:function(e,a,l){l(5331)},9104:function(e,a,l){l(5331)},5970:function(e,a,l){l(5331)},6808:function(e,a,l){l(5331),l(8785),l(7819),l(5970),l(9104)},456:function(e,a,l){l(5331)},7410:function(e,a,l){l(5331)},1008:function(e,a,l){l(5331)},8785:function(e,a,l){l(5331)},213:function(e,a,l){l(5331),l(9104)}}]);
//# sourceMappingURL=480.3a7bbcea.js.map